version: '3.9'

services:
  challenges-service:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    image: challenges-service:latest
    container_name: challenges-service
    ports:
      - "8083:8083"
    environment:
      # Server Configuration
      PORT: 8083
      
      # Database Configuration (Azure PostgreSQL)
      POSTGRES_URL: ${POSTGRES_URL}
      POSTGRES_USERNAME: ${POSTGRES_USERNAME}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      
      # JWT Configuration
      JWT_SECRET: ${JWT_SECRET}
      
      # Kafka Configuration (Azure Event Hubs)
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      KAFKA_CONNECTION_STRING: ${KAFKA_CONNECTION_STRING}
      
      # Service Discovery (Eureka)
      SERVICE_DISCOVERY_URL: ${SERVICE_DISCOVERY_URL}
      
      # Container hostname
      HOSTNAME: challenges-service
      
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8083/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    restart: unless-stopped
    
    networks:
      - levelup-network

networks:
  levelup-network:
    driver: bridge

# Para ejecutar:
# docker-compose up -d
#
# Para ver logs:
# docker-compose logs -f challenges-service
#
# Para detener:
# docker-compose down
